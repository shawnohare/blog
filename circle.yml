machine:
  environment:
    theme: "hugo-morphism"
    deploy-script-repo: "https://github.com/shawnohare/git-directory-deploy"
    publish-dir: "public"
  post:
    - mkdir -p themes static

dependencies:
  pre:
    - go get -v github.com/spf13/hugo
    - if [[ ! -d "${dir}" ]];then git clone "${repo}" "${dir}";fi:
        environment:
          dir: "themes/${theme}"
          repo: "https://github.com/shawnohare/${theme}.git"
    - git pull:
        pwd: "themes/${theme}" 
    - wget "${deploy-script-repo}/raw/master/deploy.sh"
  cache_directories:
    - bin
    - themes

test:
  override:
    - hugo -v "--theme=${theme}"
    - echo "www.smohare.com" > "${publish-dir}/CNAME"

deployment:
  production:
    branch: master
    commands:
      - bash deploy.sh "-v" "${publish-dir}" "${branch}" "${repo}":
          environment:
            branch: "test"
            repo: "https://github.com/shawnohare/shawnohare.github.io.git"
            GIT_DEPLOY_USERNAME: "Shawn O'Hare"
            GIT_DEPLOY_EMAIL: "ohare.shawn@gmail.com"
