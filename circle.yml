# NOTE: Deprecated 2018-01-08. Preserved for historical interest only.
machine:
  environment:
    content_dir: "site"
    theme: "hugo-morphism"
    theme_repo: "https://github.com/shawnohare/hugo-morphism.git"
    themes_dir: "themes"
    public_dir: "public"
    publish_branch: "master"
    publish_repo: "https://github.com/shawnohare/shawnohare.github.io.git"
    GIT_DEPLOY_USERNAME: "Shawn O'Hare"
    GIT_DEPLOY_EMAIL: "shawn@ohare.io"
  post:
    - git config --global user.name  "${GIT_DEPLOY_USERNAME}"
    - git config --global user.email "${GIT_DEPLOY_EMAIL}"

checkout:
  post:

# Base dir is the repo being watched by circleci, in this case
# e.g., github.com/shawnohare/shawnohare.com
dependencies:
  pre:
    - git clone "${theme_repo}" "${themes_dir}/${theme}"
    - go get -v github.com/gohugoio/hugo
  cache_directories:

test:
  override:
    - hugo -v -d "${public_dir}"

deployment:
  production:
    branch: master
    commands:
      - git init:
          pwd: "${public_dir}"
      - git remote add origin "${publish_repo}":
          pwd: "${public_dir}"
      - git add ".":
          pwd: "${public_dir}"
      - git commit -m "Generated by CircleCI from ${content_dir} commit ${rev}":
          pwd: "${public_dir}"
          environment:
            rev: "$(git -C ../ rev-parse HEAD)"
      - git push -f --set-upstream origin ${publish_branch}:
          pwd: "${public_dir}"
